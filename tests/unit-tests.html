<!doctype html>
<html lang="en">
<head>

  <meta name="description" content="Financial Analyzer - interactive browser-based financial analysis and reporting tool">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#0d6efd">
  <!-- Tailwind CDN (for rapid UI polish) -->
  <script src="https://cdn.tailwindcss.com"></script>

<meta charset="utf-8"/>
<title>FA Unit Tests</title>
<link rel="stylesheet" href="css/fa_enhancements.css">
</head>
<body>
  <header role="banner" class="sr-only">Financial Analyzer header</header>
<div class="site-header">
  <div class="left">
    <img src="assets/logo.png" class="logo" alt="logo">
    <div><strong data-i18n="app_title">Financial Analyzer</strong></div>
  </div>
  <div class="controls no-print">
    <label><input type="checkbox" onchange="toggleDark(this)" /> <span data-i18n="toggle_dark">Dark Mode</span></label>
    <select onchange="changeCurrency(this)" class="control-select">
      <option value="USD">USD</option><option value="EUR">EUR</option><option value="EGP">EGP</option>
    </select>
    <select onchange="changeLang(this)" class="control-select">
      <option value="en">English</option><option value="ar">العربية</option>
    </select>
  </div>
</div>

<main style="padding:20px" role="main">
  <h2>Unit Tests</h2>
  <button onclick="runTests()">Run Tests</button>
  <pre id="out"></pre>
</main>

<script src="js/fa_enhancements.js"></script>

<script>
async function runAll(){
  const results = [];
  try{
    // trial balance test
    const tRes = fa_run_tests();
    results.push({name:'trial_balance_tests', result: tRes});

    // Excel export availability
    const excelAvailable = typeof ExcelJS !== 'undefined';
    results.push({name:'exceljs_loaded', ok: excelAvailable});

    // fetch logo test
    try{
      const r = await fetch('assets/logo.png', {method:'GET'});
      results.push({name:'logo_fetch', ok: r.ok, status: r.status});
    }catch(e){
      results.push({name:'logo_fetch', ok:false, err: e.toString()});
    }

    // Forecast test
    try{
      const series = [100,110,115,120,130,140,150];
      const train = series.slice(0,5);
      const hold = series.slice(5);
      const {forecast, model} = linearRegressionForecast(train, hold.length);
      const mape = computeMAPE(hold, forecast);
      const rmse = computeRMSE(hold, forecast);
      results.push({name:'forecast_test', ok: true, model, forecast, mape, rmse});
    }catch(e){
      results.push({name:'forecast_test', ok:false, err: e.toString()});
    }

    // CSV import test: create a temp CSV and try parse
    try{
      const csv = 'Cash,100,0
Sales,0,100';
      const table = document.createElement('table');
      table.id = 'temp-trial';
      table.innerHTML = '<thead><tr><th>Account</th><th>Debit</th><th>Credit</th></tr></thead><tbody></tbody>';
      document.body.appendChild(table);
      const ok = parseCSVtoTable(csv, '#temp-trial');
      results.push({name:'csv_import_test', ok: ok, rows: table.querySelectorAll('tbody tr').length});
      table.remove();
    }catch(e){
      results.push({name:'csv_import_test', ok:false, err: e.toString()});
    }

  }catch(e){
    results.push({name:'exception', ok:false, err: e.toString()});
  }
  document.getElementById('out').textContent = JSON.stringify(results, null, 2);
}
window.runTests = runAll;
</script>


  <script src="js/fa_forecast.js"></script>
</body>
</html>
