<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title data-translate-key="pageTitle">لوحة التحكم — المحلل المالي</title>
<script src="js/auth-guard.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
<link rel="stylesheet" href="css/style.css">
<link rel="manifest" href="manifest.json">
<style>
.kpi-card {
background-color: var(--bs-card-bg);
border: 1px solid var(--bs-border-color);
border-radius: .5rem;
padding: 1.5rem;
text-align: center;
position: relative;
height: 100%;
box-shadow: 0 4px 12px rgba(0,0,0,0.05);
transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.kpi-card:hover {
transform: translateY(-3px);
box-shadow: 0 6px 16px rgba(0,0,0,0.08);
}
.gauge-chart-container {
position: relative;
height: 100px;
margin-bottom: 0.5rem;
}
.gauge-value {
position: absolute;
top: 60%;
left: 50%;
transform: translate(-50%, -50%);
font-size: 2.25rem;
font-weight: 700;
color: var(--bs-primary-text-emphasis);
}
.gauge-label {
font-size: 0.9rem;
font-weight: 600;
color: var(--bs-secondary-color);
margin-top: 0.5rem;
}
.kpi-simple-card .gauge-value {
position: relative;
top: 0;
left: 0;
transform: none;
font-size: 2.5rem;
line-height: 1.2;
}
.kpi-simple-card .gauge-chart-container {
height: 100px;
display: flex;
align-items: center;
justify-content: center;
}
#alertsArea .list-group-item {
background-color: transparent;
border: none;
padding-left: 0;
padding-right: 0;
font-weight: 500;
}
@media print {
.no-print { display: none !important; }
body { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
.card-surface { border: 1px solid #dee2e6 !important; box-shadow: none !important; }
.watermark-container { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.1; z-index: -1; }
.watermark-logo { max-width: 50%; height: auto; }
main { padding-top: 1rem !important; padding-bottom: 1rem !important; }
}
.watermark-container { display: none; }
@media print { .watermark-container { display: block; } }
</style>
</head>
<body data-theme="light">
<div id="navbar-placeholder" class="no-print"></div>
<main class="container-main py-4">
<div id="dashboard-content">
<div class="watermark-container">
<img src="assets/logo.png" class="watermark-logo" alt="Watermark">
</div>          
<section class="page-header d-flex justify-content-between align-items-center mb-4">
<div>
<h1 data-translate-key="pageHeader"></h1>
<p class="text-muted" data-translate-key="pageSubheader"></p>
</div>
<div class="d-flex gap-2 no-print">
<button id="exportPdfBtn" class="btn btn-danger"><i class="bi bi-file-earmark-pdf"></i> <span data-translate-key="exportPdf"></span></button>
</div>
</section>
<div class="row mb-4" id="loadingContainer">
<div class="col-12">
<div class="alert alert-warning" id="loadingMessage" data-translate-key="loadingData">جاري تحميل البيانات...</div>
</div>
            </div>
            <div id="singlePeriodView" style="display: none;">
                <section class="row g-4 mb-4">
                    <div class="col-lg-3 col-md-6">
                        <div class="kpi-card">
                            <div class="gauge-chart-container">
                                <canvas id="gaugeCurrentRatio"></canvas>
                                <div id="gaugeCurrentRatioValue" class="gauge-value">...</div>
                            </div>
                            <div class="gauge-label" data-translate-key="kpi_currentRatio"></div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="kpi-card">
                            <div class="gauge-chart-container">
                                <canvas id="gaugeNetProfitMargin"></canvas>
                                <div id="gaugeNetProfitMarginValue" class="gauge-value">...</div>
                            </div>
                            <div class="gauge-label" data-translate-key="kpi_netProfitMargin"></div>
                        </div>
                    </div>
                     <div class="col-lg-3 col-md-6">
                        <div class="kpi-card">
                            <div class="gauge-chart-container">
                                <canvas id="gaugeZScore"></canvas>
                                <div id="gaugeZScoreValue" class="gauge-value">...</div>
                            </div>
                            <div class="gauge-label" data-translate-key="kpi_zscore"></div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                         <div class="kpi-card kpi-simple-card">
                            <div class="gauge-chart-container">
                                <div id="kpiNetProfitValue" class="gauge-value">...</div>
                            </div>
                            <div class="gauge-label" data-translate-key="kpi_netProfit"></div>
                        </div>
                    </div>
                </section>              
                <section class="row g-4">
                    <div class="col-lg-7">
                        <div class="card-surface">
                            <h5 data-translate-key="chartProfitTitle"></h5>
                            <div class="chart-wrap" style="height: 350px;">
                                <canvas id="profitabilityChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <div class="card-surface">
                            <h5 data-translate-key="chartStructureTitle"></h5>
                            <div class="chart-wrap" style="height: 350px;">
                                <canvas id="structureChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card-surface h-100">
                            <h5 data-translate-key="summaryTitle"></h5>
                            <div id="performanceSummary" class="analysis-comment fs-5"></div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                         <div class="card-surface h-100">
                             <h5 data-translate-key="alertsTitle"></h5>
                             <div id="alertsArea" class="list-group list-group-flush">
                                </div>
                         </div>
                    </div>
                </section>
            </div>          
            <div id="trendAnalysisView" style="display: none;">
                 <section class="row g-4 mb-4">
                     <div class="col-lg-4 col-md-6">
                        <div class="kpi-card kpi-simple-card">
                             <div class="gauge-chart-container">
                                <div id="trendNetProfit" class="gauge-value">...</div>
                             </div>
                             <div class="gauge-label" data-translate-key="trend_kpi_netProfit"></div>
                        </div>
                     </div>
                     <div class="col-lg-4 col-md-6">
                        <div class="kpi-card kpi-simple-card">
                             <div class="gauge-chart-container">
                                <div id="trendRevenue" class="gauge-value">...</div>
                             </div>
                             <div class="gauge-label" data-translate-key="trend_kpi_revenue"></div>
                        </div>
                     </div>
                     <div class="col-lg-4 col-md-6">
                        <div class="kpi-card kpi-simple-card">
                             <div class="gauge-chart-container">
                                <div id="trendCurrentRatio" class="gauge-value">...</div>
                             </div>
                             <div class="gauge-label" data-translate-key="trend_kpi_currentRatio"></div>
                        </div>
                     </div>
                </section>
                <section class="row g-4">
                    <div class="col-lg-12">
                        <div class="card-surface">
                            <h5 data-translate-key="chartProfitTrendTitle"></h5>
                            <div class="chart-wrap" style="height: 350px;">
                                <canvas id="profitTrendChart"></canvas>
                            </div>
                        </div>
                    </div>
<div class="col-lg-12 mt-4">
<div class="card-surface">
<h5 data-translate-key="chartRatiosTrendTitle"></h5>
<div class="chart-wrap" style="height: 350px;">
<canvas id="ratiosTrendChart"></canvas>
</div>
</div>
</div>
</section>
</div>
</div> 
</main>   
<div id="footer-placeholder" class="no-print"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="js/main.js"></script>
<script src="js/dashboard-app.js"></script>
<script>
if ('serviceWorker' in navigator) {
window.addEventListener('load', () => {
navigator.serviceWorker.register('service-worker.js')
.then((reg) => {
console.log('Service worker متسجل وتمام:', reg);
})
.catch((err) => {
console.log('فشل تسجيل Service worker:', err);
});
});
}
</script>
</body>
</html>

