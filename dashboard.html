<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ultra Global Dashboard | Financial Analyzer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
  body { margin:0; font-family:'Cairo', sans-serif; background:#f0f2f5; transition: all 0.3s ease; color:#333;}
  .dark-mode { background:#1c1c1c; color:#f1f1f1;}
  header { display:flex; justify-content:space-between; align-items:center; padding:15px; background: linear-gradient(90deg,#004080,#00bfff); color:#fff;}
  header img { height:40px; border-radius:6px;}
  nav button, nav select { margin:0 5px; padding:8px 12px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; transition:0.3s;}
  nav select { border:1px solid #ccc; }
  nav button:hover, nav select:hover { opacity:0.8;}
  .container { padding:20px; }
  h1,h2 { color:#004080; }
  table { width:100%; border-collapse:collapse; margin-bottom:20px; background: rgba(255,255,255,0.85); backdrop-filter: blur(10px); border-radius:6px; overflow:hidden;}
  table th, table td { padding:10px; text-align:center; border-bottom:1px solid #ccc; }
  table th { background: rgba(0,64,128,0.9); color:#fff; }
  footer { background:#004080; color:#fff; text-align:center; padding:10px; }
  canvas { margin:20px 0; max-width:100%; }
  .controls { margin:20px 0; display:flex; flex-wrap:wrap; gap:10px; align-items:center;}
  .comment { margin:10px 0; font-style:italic; }
</style>
</head>
<body>
<header>
  <div style="display:flex;align-items:center;gap:10px;">
    <img src="logo.png" alt="Logo">
    <span style="font-size:20px;font-weight:bold;" id="headerTitle">لوحة التحكم المالية</span>
  </div>
  <nav>
    <button onclick="location.href='index.html'" id="homeBtn">🏠 الرئيسية</button>
    <button onclick="location.href='report.html'" id="reportBtn">📑 التقرير المالي</button>
    <button onclick="location.href='advanced.html'" id="advancedBtn">📊 التحليلات المتقدمة</button>
    <button onclick="toggleDarkMode()" id="darkModeBtn">🌙/☀️</button>
    <select id="lang" onchange="changeLanguage()">
      <option value="ar">🇪🇬 عربي</option>
      <option value="en">🇺🇸 English</option>
    </select>
    <select id="currency" onchange="updateCurrency()">
      <option value="EGP">EGP</option>
      <option value="USD">USD</option>
      <option value="EUR">EUR</option>
    </select>
    <button onclick="exportPDF()" id="exportBtn">📄 PDF</button>
  </nav>
</header>

<div class="container">
  <h1 id="pageTitle">📊 لوحة التحكم المالية</h1>

  <div class="controls">
    <label id="yearLabel">📅 اختر السنة: </label>
    <select id="yearSelect" onchange="refreshDashboard()"></select>
  </div>

  <h2 id="bsTitle">الميزانية العمومية</h2>
  <table id="balanceSheet"></table>
  <div class="comment" id="bsComment"></div>
  <canvas id="balanceChart"></canvas>

  <h2 id="isTitle">قائمة الدخل</h2>
  <table id="incomeStatement"></table>
  <div class="comment" id="isComment"></div>
  <canvas id="incomeChart"></canvas>

  <h2 id="cfTitle">التدفقات النقدية</h2>
  <table id="cashFlow"></table>
  <div class="comment" id="cfComment"></div>
  <canvas id="cashChart"></canvas>

  <h2 id="eqTitle">حقوق الملكية</h2>
  <table id="equity"></table>
  <div class="comment" id="eqComment"></div>
  <canvas id="equityChart"></canvas>
</div>

<footer>
  &copy; 2025 Financial Analyzer - جميع الحقوق محفوظة
</footer>

<script>
// بيانات تجريبية - سيتم ملؤها من LocalStorage
let currency = 'EGP';
let lang = 'ar';
let data = JSON.parse(localStorage.getItem('financialData')) || {
  "years": ["2023","2022","2021"],
  "balanceSheet": {"الأصول المتداولة":[500000,450000,400000],"الأصول الثابتة":[800000,700000,600000],"الخصوم":[400000,350000,300000],"حقوق الملكية":[900000,800000,700000]},
  "incomeStatement": {"الإيرادات":[1200000,1000000,900000],"المصروفات":[700000,600000,500000],"صافي الربح":[500000,400000,400000]},
  "cashFlow": {"التشغيل":[300000,250000,200000],"الاستثمار":[-100000,-80000,-70000],"التمويل":[50000,60000,50000]},
  "equity": {"رأس المال":[500000,500000,500000],"الأرباح المحتجزة":[400000,300000,200000]}
};

function toggleDarkMode(){document.body.classList.toggle('dark-mode');}

function populateYears(){
  let ySelect = document.getElementById('yearSelect');
  ySelect.innerHTML='';
  data.years.forEach(year=>{
    let opt = document.createElement('option');
    opt.value=year; opt.textContent=year;
    ySelect.appendChild(opt);
  });
}

function generateTable(tableId, dataset, yearIndex){
  let table = document.getElementById(tableId);
  table.innerHTML='';
  let thead = document.createElement('thead');
  let tr = document.createElement('tr');
  tr.innerHTML=`<th id="colItem">البند</th><th>${data.years[yearIndex]}</th>`;
  if(data.years[yearIndex-1]) tr.innerHTML+=`<th>${data.years[yearIndex-1]}</th><th id="colDiff">الانحراف</th>`;
  thead.appendChild(tr); table.appendChild(thead);
  let tbody = document.createElement('tbody');
  for(let item in dataset){
    let valCurrent = dataset[item][yearIndex];
    let valPrev = dataset[item][yearIndex-1]||0;
    let diff = valPrev?(((valCurrent-valPrev)/valPrev)*100).toFixed(1)+'%':'=';
    let trd = document.createElement('tr');
    trd.innerHTML=`<td>${item}</td><td>${valCurrent.toLocaleString()} ${currency}</td>`+
                  (valPrev?`<td>${valPrev.toLocaleString()} ${currency}</td><td>${diff}</td>`:'');
    tbody.appendChild(trd);
  }
  table.appendChild(tbody);
}

function updateCharts(yearIndex){
  new Chart(document.getElementById('balanceChart'), {
    type:'bar',
    data:{labels:Object.keys(data.balanceSheet),datasets:[
      {label:data.years[yearIndex],data:Object.values(data.balanceSheet).map(a=>a[yearIndex]),backgroundColor:'#004080'},
      {label:data.years[yearIndex-1]||'',data:Object.values(data.balanceSheet).map(a=>a[yearIndex-1]||0),backgroundColor:'#00bfff'}
    ]}
  });
  new Chart(document.getElementById('incomeChart'), {
    type:'line',
    data:{labels:Object.keys(data.incomeStatement),datasets:[
      {label:data.years[yearIndex],data:Object.values(data.incomeStatement).map(a=>a[yearIndex]),borderColor:'#004080',fill:false},
      {label:data.years[yearIndex-1]||'',data:Object.values(data.incomeStatement).map(a=>a[yearIndex-1]||0),borderColor:'#00bfff',fill:false}
    ]}
  });
  new Chart(document.getElementById('cashChart'), {
    type:'pie',
    data:{labels:Object.keys(data.cashFlow),datasets:[{data:Object.values(data.cashFlow).map(a=>a[yearIndex]),backgroundColor:['#28a745','#ffc107','#dc3545']}]}
  });
  new Chart(document.getElementById('equityChart'), {
    type:'doughnut',
    data:{labels:Object.keys(data.equity),datasets:[{data:Object.values(data.equity).map(a=>a[yearIndex]),backgroundColor:['#004080','#00bfff']}]}
  });
}

function generateComments(yearIndex){
  document.getElementById('bsComment').textContent='الأصول والخصوم تشير إلى توازن جيد.'; 
  document.getElementById('isComment').textContent='صافي الربح في ارتفاع مستقر، أداء إيجابي.'; 
  document.getElementById('cfComment').textContent='التدفقات التشغيلية قوية، الاستثمارات معتدلة.'; 
  document.getElementById('eqComment').textContent='حقوق الملكية متنامية، رأس المال مستقر.';
}

function refreshDashboard(){
  let yearIndex = document.getElementById('yearSelect').selectedIndex;
  generateTable('balanceSheet',data.balanceSheet,yearIndex);
  generateTable('incomeStatement',data.incomeStatement,yearIndex);
  generateTable('cashFlow',data.cashFlow,yearIndex);
  generateTable('equity',data.equity,yearIndex);
  updateCharts(yearIndex);
  generateComments(yearIndex);
}

function updateCurrency(){
  currency = document.getElementById('currency').value;
  refreshDashboard();
}

function changeLanguage(){
  lang = document.getElementById('lang').value;
  if(lang==='en'){
    document.getElementById('headerTitle').textContent='Financial Dashboard';
    document.getElementById('pageTitle').textContent='📊 Financial Dashboard';
    document.getElementById('yearLabel').textContent='📅 Select Year:';
    document.getElementById('bsTitle').textContent='Balance Sheet';
    document.getElementById('isTitle').textContent='Income Statement';
    document.getElementById('cfTitle').textContent='Cash Flow Statement';
    document.getElementById('eqTitle').textContent='Equity Statement';
    document.getElementById('homeBtn').textContent='🏠 Home';
    document.getElementById('reportBtn').textContent='📑 Report';
    document.getElementById('advancedBtn').textContent='📊 Advanced';
    document.getElementById('darkModeBtn').textContent='🌙/☀️';
    document.getElementById('exportBtn').textContent='📄 Export PDF';
    // الترجمة داخل الجداول
    refreshDashboard();
  }else{
    document.getElementById('headerTitle').textContent='لوحة التحكم المالية';
    document.getElementById('pageTitle').textContent='📊 لوحة التحكم المالية';
    document.getElementById('yearLabel').textContent='📅 اختر السنة:';
    document.getElementById('bsTitle').textContent='الميزانية العمومية';
    document.getElementById('isTitle').textContent='قائمة الدخل';
    document.getElementById('cfTitle').textContent='التدفقات النقدية';
    document.getElementById('eqTitle').textContent='حقوق الملكية';
    document.getElementById('homeBtn').textContent='🏠 الرئيسية';
    document.getElementById('reportBtn').textContent='📑 التقرير المالي';
    document.getElementById('advancedBtn').textContent='📊 التحليلات المتقدمة';
    document.getElementById('darkModeBtn').textContent='🌙/☀️';
    document.getElementById('exportBtn').textContent='📄 PDF';
    refreshDashboard();
  }
}

function exportPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("Financial Dashboard Report",20,20);
  doc.save("dashboard.pdf");
}

populateYears();
refreshDashboard();
</script>
</body>
</html>
