<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>التحليلات المتقدمة | Financial Analyzer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: "Cairo", sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #e9f0ff, #ffffff);
      color: #222;
      transition: all 0.4s ease;
    }
    header {
      background: rgba(0,64,128,0.9);
      backdrop-filter: blur(10px);
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 25px;
    }
    header h1 { font-size: 20px; }
    nav button, nav select {
      margin: 0 5px;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #fff;
      color: #004080;
      font-weight: bold;
    }
    nav button:hover { background: #f0f0f0; }
    .container {
      padding: 25px;
      max-width: 1200px;
      margin: auto;
    }
    h2 {
      color: #004080;
      border-bottom: 2px solid #004080;
      padding-bottom: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: rgba(255,255,255,0.8);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
    }
    th {
      background: #004080;
      color: #fff;
    }
    canvas {
      margin: 20px auto;
      display: block;
      max-width: 800px;
    }
    .comment {
      background: #f0f8ff;
      padding: 10px 15px;
      border-left: 4px solid #004080;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    footer {
      text-align: center;
      background: #004080;
      color: white;
      padding: 10px;
    }
    .dark-mode {
      background: #1c1c1c;
      color: #f5f5f5;
    }
    .dark-mode th { background: #222; }
    .dark-mode .comment { background: #2c2c2c; border-left-color: #00bfff; }
  </style>
</head>
<body>
  <header>
    <h1 id="pageTitle">📊 التحليلات المتقدمة</h1>
    <nav>
      <button onclick="location.href='index.html'">🏠 الرئيسية</button>
      <button onclick="toggleDarkMode()">🌙/☀️</button>
      <select id="lang" onchange="changeLanguage()">
        <option value="ar">🇪🇬 عربي</option>
        <option value="en">🇺🇸 English</option>
      </select>
    </nav>
  </header>

  <div class="container">
    <h2 id="ratiosTitle">تحليل النسب المالية</h2>
    <table id="ratiosTable">
      <thead>
        <tr><th>النسبة</th><th>القيمة</th><th>التفسير</th></tr>
      </thead>
      <tbody id="ratiosBody"></tbody>
    </table>

    <canvas id="ratiosChart"></canvas>

    <h2 id="evaTitle">القيمة الاقتصادية المضافة</h2>
    <div class="comment" id="evaComment"></div>
    <canvas id="evaChart"></canvas>

    <h2 id="forecastTitle">🔮 التنبؤ بالأداء المستقبلي</h2>
    <div class="comment" id="forecastComment"></div>
    <canvas id="forecastChart"></canvas>
  </div>

  <footer>
    &copy; 2025 Financial Analyzer — جميع الحقوق محفوظة.
  </footer>

  <script>
    // Dark Mode
    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    // Load data from Local Storage
    let data = JSON.parse(localStorage.getItem("financialData")) || {
      revenues: [1200000, 1000000],
      expenses: [700000, 600000],
      assets: [1300000, 1150000],
      liabilities: [400000, 350000],
      equity: [900000, 800000],
    };

    // Ratios
    const ratios = {
      "هامش الربح الصافي": data.revenues[0] ? (data.revenues[0] - data.expenses[0]) / data.revenues[0] : 0,
      "العائد على الأصول": data.assets[0] ? ((data.revenues[0] - data.expenses[0]) / data.assets[0]) : 0,
      "العائد على حقوق الملكية": data.equity[0] ? ((data.revenues[0] - data.expenses[0]) / data.equity[0]) : 0,
      "نسبة المديونية": data.assets[0] ? (data.liabilities[0] / data.assets[0]) : 0,
    };

    // Populate Table
    const tbody = document.getElementById("ratiosBody");
    for (const [name, value] of Object.entries(ratios)) {
      const tr = document.createElement("tr");
      const interpretation =
        value > 0.25 ? "📈 أداء قوي يشير إلى كفاءة عالية في الإدارة المالية." :
        value > 0 ? "⚖️ أداء متوسط يحتاج إلى تحسين في الكفاءة التشغيلية." :
        "🔻 مؤشرات سلبية تستدعي مراجعة السياسات المالية.";
      tr.innerHTML = `<td>${name}</td><td>${(value*100).toFixed(2)}%</td><td>${interpretation}</td>`;
      tbody.appendChild(tr);
    }

    // Ratios Chart
    new Chart(document.getElementById("ratiosChart"), {
      type: "bar",
      data: {
        labels: Object.keys(ratios),
        datasets: [{
          label: "القيم (%)",
          data: Object.values(ratios).map(v => v*100),
          backgroundColor: ["#004080","#00bfff","#0077cc","#3399ff"]
        }]
      }
    });

    // EVA Chart
    const eva = (data.revenues[0] - data.expenses[0]) - (0.1 * data.equity[0]);
    document.getElementById("evaComment").innerText =
      eva > 0 ? "✅ المشروع يولّد قيمة اقتصادية مضافة للمستثمرين." :
      "⚠️ القيمة الاقتصادية المضافة سلبية، يجب تحسين العائد على رأس المال.";
    new Chart(document.getElementById("evaChart"), {
      type: "doughnut",
      data: {
        labels: ["القيمة الاقتصادية المضافة", "تكلفة رأس المال"],
        datasets: [{
          data: [eva > 0 ? eva : 0, eva > 0 ? 0 : -eva],
          backgroundColor: ["#28a745", "#dc3545"]
        }]
      }
    });

    // Forecast (تنبؤ بسيط باستخدام معدل النمو)
    const growth = ((data.revenues[0] - data.revenues[1]) / data.revenues[1]) || 0;
    const forecastRevenue = data.revenues[0] * (1 + growth);
    document.getElementById("forecastComment").innerText =
      growth > 0 ? "📊 من المتوقع استمرار النمو خلال الفترات القادمة." :
      "📉 الأداء يتراجع ويحتاج إلى تدخل إداري لتحسين الاتجاه.";
    new Chart(document.getElementById("forecastChart"), {
      type: "line",
      data: {
        labels: ["2022","2023","2024 (تنبؤ)"],
        datasets: [{
          label: "الإيرادات",
          data: [data.revenues[1], data.revenues[0], forecastRevenue],
          borderColor: "#004080",
          fill: false
        }]
      }
    });

    // Translation
    function changeLanguage() {
      const lang = document.getElementById("lang").value;
      const ar = lang === "ar";
      document.documentElement.dir = ar ? "rtl" : "ltr";
      document.getElementById("pageTitle").innerText = ar ? "📊 التحليلات المتقدمة" : "📊 Advanced Analytics";
      document.getElementById("ratiosTitle").innerText = ar ? "تحليل النسب المالية" : "Financial Ratios Analysis";
      document.getElementById("evaTitle").innerText = ar ? "القيمة الاقتصادية المضافة" : "Economic Value Added (EVA)";
      document.getElementById("forecastTitle").innerText = ar ? "🔮 التنبؤ بالأداء المستقبلي" : "🔮 Performance Forecasting";
    }
  </script>
</body>
</html>
