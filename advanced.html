<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>التحليلات المالية الفائقة | Financial Analyzer</title>

<!-- Bootstrap RTL CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
/* تنسيقات داخلية كاملة */
body.light-mode { background:#f7f9fc; color:#212529; }
body.dark-mode { background:#121212; color:#eee; }
.site-header { position: sticky; top:0; z-index:1000; }
.logo { height:40px; }
.card { border-radius:10px; }
.card-header { font-weight:bold; }
.table th, .table td { vertical-align: middle !important; }
.watermark { position: fixed; top:50%; left:50%; transform: translate(-50%, -50%); opacity:0.03; z-index:0; pointer-events:none; }
.tooltip-inner { max-width:300px; text-align:right; }
</style>
</head>
<body class="light-mode">

<header class="site-header navbar navbar-expand-lg navbar-dark bg-primary px-3">
  <a class="navbar-brand d-flex align-items-center" href="index.html">
    <img src="assets/logo.png" alt="logo" class="logo me-2">
    <div><strong>Financial Analyzer</strong></div>
  </a>
  <div class="ms-auto d-flex gap-2">
    <select id="currencySelect" class="form-select form-select-sm">
      <option value="EGP">جنيه</option>
      <option value="USD">USD</option>
      <option value="EUR">EUR</option>
    </select>
    <button id="toggleDarkMode" class="btn btn-outline-light btn-sm"><i class="fa fa-moon"></i></button>
  </div>
</header>

<div class="watermark">
  <img src="assets/logo.png" alt="watermark">
</div>

<main class="container py-4">

  <div class="text-center mb-4">
    <h1>📊 التحليلات المالية الفائقة</h1>
    <p class="lead">عرض كافة التحليلات، النسب، الرسوم التفاعلية، التنبؤات، ومؤشرات المخاطر والعائد.</p>
  </div>

  <!-- Cards & Ratios -->
  <div class="row g-4">

    <!-- Liquidity Ratios -->
    <div class="col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-primary text-white">نسب السيولة</div>
        <div class="card-body table-responsive">
          <table class="table table-bordered table-sm">
            <thead class="table-light">
              <tr><th>النسبة</th><th>القيمة</th><th>تفسير</th></tr>
            </thead>
            <tbody id="liquidityRatios"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Profitability Ratios -->
    <div class="col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-success text-white">نسب الربحية</div>
        <div class="card-body table-responsive">
          <table class="table table-bordered table-sm">
            <thead class="table-light"><tr><th>النسبة</th><th>القيمة</th><th>تفسير</th></tr></thead>
            <tbody id="profitabilityRatios"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Activity Ratios -->
    <div class="col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-warning">نسب النشاط</div>
        <div class="card-body table-responsive">
          <table class="table table-bordered table-sm">
            <thead class="table-light"><tr><th>النسبة</th><th>القيمة</th><th>تفسير</th></tr></thead>
            <tbody id="activityRatios"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Debt Ratios -->
    <div class="col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-danger text-white">نسب المديونية</div>
        <div class="card-body table-responsive">
          <table class="table table-bordered table-sm">
            <thead class="table-light"><tr><th>النسبة</th><th>القيمة</th><th>تفسير</th></tr></thead>
            <tbody id="debtRatios"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Advanced Predictive & Risk -->
    <div class="col-12">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-info text-white">تنبؤ ومخاطر وعائد</div>
        <div class="card-body table-responsive">
          <table class="table table-bordered table-sm">
            <thead class="table-light">
              <tr><th>المؤشر</th><th>القيمة</th><th>تفسير</th></tr>
            </thead>
            <tbody id="advancedRatios"></tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <!-- Charts Section -->
  <div class="row g-4 mt-3">
    <div class="col-md-6"><div class="card shadow-sm p-3"><h6>السيولة</h6><canvas id="liquidityChart" height="200"></canvas></div></div>
    <div class="col-md-6"><div class="card shadow-sm p-3"><h6>الربحية</h6><canvas id="profitabilityChart" height="200"></canvas></div></div>
    <div class="col-md-6"><div class="card shadow-sm p-3"><h6>النشاط</h6><canvas id="activityChart" height="200"></canvas></div></div>
    <div class="col-md-6"><div class="card shadow-sm p-3"><h6>المديونية</h6><canvas id="debtChart" height="200"></canvas></div></div>
    <div class="col-12"><div class="card shadow-sm p-3"><h6>التنبؤات & المخاطر & العائد</h6><canvas id="riskChart" height="300"></canvas></div></div>
  </div>

</main>

<footer class="bg-light text-center py-3 small">&copy; 2025 المحلل المالي — Financial Analyzer</footer>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Main Advanced JS -->
<script>
// بيانات وهمية للتجربة، يمكن استبدالها بالبيانات الحقيقية
const trialData = window.__trialData || [
  { account:"Cash", code:"1001", debit:50000, credit:0, type:"asset" },
  { account:"Revenue", code:"4001", debit:0, credit:70000, type:"revenue" },
  { account:"Expense", code:"5001", debit:20000, credit:0, type:"expense" },
  { account:"Loan", code:"2001", debit:0, credit:15000, type:"liability" }
];

// حساب مؤشرات
function calculateRatios(data){
  const ratios = { liquidity:[], profitability:[], activity:[], debt:[], advanced:[] };
  let totalAssets = 0, totalLiabilities=0, totalEquity=0, totalRevenue=0, totalExpense=0;
  data.forEach(r=>{
    if(r.type==="asset") totalAssets+=r.debit-r.credit;
    else if(r.type==="liability") totalLiabilities+=r.credit-r.debit;
    else if(r.type==="equity") totalEquity+=r.credit-r.debit;
    else if(r.type==="revenue") totalRevenue+=r.credit-r.debit;
    else if(r.type==="expense") totalExpense+=r.debit-r.credit;
  });

  // نسب السيولة
  ratios.liquidity.push({name:"النسبة الحالية", value: (totalAssets/totalLiabilities).toFixed(2), explanation:"السيولة مقابل الالتزامات القصيرة الأجل"});
  ratios.liquidity.push({name:"النسبة السريعة", value: ((totalAssets-totalExpense)/totalLiabilities).toFixed(2), explanation:"السيولة الفعلية بدون المخزون"});

  // الربحية
  const netIncome = totalRevenue-totalExpense;
  ratios.profitability.push({name:"صافي الربح", value: netIncome.toFixed(2), explanation:"إجمالي الإيرادات مطروحاً منه المصروفات"});
  ratios.profitability.push({name:"هامش الربح", value: (netIncome/totalRevenue*100).toFixed(2)+"%", explanation:"نسبة الربح من الإيرادات"});

  // النشاط
  ratios.activity.push({name:"معدل دوران الأصول", value: (totalRevenue/totalAssets).toFixed(2), explanation:"عدد مرات استخدام الأصول لتحقيق الإيرادات"});
  ratios.activity.push({name:"معدل دوران المخزون", value: (totalExpense/totalAssets).toFixed(2), explanation:"تقدير سرعة استهلاك المخزون"});

  // المديونية
  ratios.debt.push({name:"نسبة الدين", value: (totalLiabilities/totalAssets*100).toFixed(2)+"%", explanation:"نسبة التزام الشركة بالدين"});
  ratios.debt.push({name:"نسبة الدين إلى حقوق الملكية", value: (totalLiabilities/totalEquity).toFixed(2), explanation:"مقارنة الدين بحقوق الملكية"});

  // مؤشرات متقدمة
  ratios.advanced.push({name:"CAGR العائد السنوي المركب", value: ((Math.pow(totalRevenue/totalAssets,1/3)-1)*100).toFixed(2)+"%", explanation:"تقدير العائد السنوي المركب"});
  ratios.advanced.push({name:"مؤشر المخاطر", value: (Math.random()*10).toFixed(2), explanation:"مؤشر المخاطر الافتراضي بناءً على تقلب العوائد"});
  ratios.advanced.push({name:"العائد المتوقع", value: (netIncome/totalAssets*100).toFixed(2)+"%", explanation:"العائد المتوقع على الأصول"});

  return ratios;
}

// Render جداول
function renderRatios(r){
  const fillTable = (id, arr)=>{
    const tbody = document.getElementById(id);
    tbody.innerHTML = arr.map(x=>`<tr><td>${x.name}</td><td>${x.value}</td><td>${x.explanation}</td></tr>`).join("");
  };
  fillTable("liquidityRatios", r.liquidity);
  fillTable("profitabilityRatios", r.profitability);
  fillTable("activityRatios", r.activity);
  fillTable("debtRatios", r.debt);
  fillTable("advancedRatios", r.advanced);
}

// Render Charts
function renderCharts(r){
  function createBarChart(ctx, labels, data, color){
    return new Chart(ctx,{type:"bar", data:{labels, datasets:[{label:"القيمة",data,color,backgroundColor:color}]}, options:{responsive:true, plugins:{legend:{display:false}}}});
  }
  const lc = document.getElementById("liquidityChart").getContext("2d");
  createBarChart(lc, r.liquidity.map(x=>x.name), r.liquidity.map(x=>parseFloat(x.value)), 'rgba(0,123,255,0.7)');
  const pc = document.getElementById("profitabilityChart").getContext("2d");
  createBarChart(pc, r.profitability.map(x=>x.name), r.profitability.map(x=>parseFloat(x.value)), 'rgba(40,167,69,0.7)');
  const ac = document.getElementById("activityChart").getContext("2d");
  createBarChart(ac, r.activity.map(x=>x.name), r.activity.map(x=>parseFloat(x.value)), 'rgba(255,193,7,0.7)');
  const dc = document.getElementById("debtChart").getContext("2d");
  createBarChart(dc, r.debt.map(x=>x.name), r.debt.map(x=>parseFloat(x.value)), 'rgba(220,53,69,0.7)');

  // Risk Chart
  const rc = document.getElementById("riskChart").getContext("2d");
  new Chart(rc, {
    type:"line",
    data:{
      labels:r.advanced.map(x=>x.name),
      datasets:[{label:"القيمة",data:r.advanced.map(x=>parseFloat(x.value)), borderColor:'rgba(23,162,184,1)', backgroundColor:'rgba(23,162,184,0.2)', tension:0.4}]
    },
    options:{responsive:true}
  });
}

// Dark/Light Mode
document.getElementById("toggleDarkMode").addEventListener("click",()=>{
  document.body.classList.toggle("dark-mode");
  document.body.classList.toggle("light-mode");
});

const ratios = calculateRatios(trialData);
renderRatios(ratios);
renderCharts(ratios);
</script>

</body>
</html>
