<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ | Financial Analyzer</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; transition: background 0.3s, color 0.3s;}
.light-mode { background:#f4f4f4; color:#333;}
.dark-mode { background:#1e1e1e; color:#f4f4f4;}
header { background:#007bff; color:white; display:flex; align-items:center; justify-content:space-between; padding:0.5rem 1rem; }
header .logo { height:40px; }
header select, header button { margin-left:0.5rem; cursor:pointer;}
.watermark { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); opacity:0.05; z-index:-1;}
main { padding:1rem; max-width:1400px; margin:auto;}
.card { background:white; border-radius:0.5rem; box-shadow:0 2px 12px rgba(0,0,0,0.15); margin-bottom:1rem; padding:1rem; transition: transform 0.2s;}
.card:hover { transform: translateY(-3px);}
.dark-mode .card { background:#2b2b2b; color:#f4f4f4;}
.card-header { font-weight:bold; font-size:1rem; margin-bottom:0.5rem; }
table { width:100%; border-collapse:collapse; margin-top:0.5rem;}
th, td { padding:0.5rem; border:1px solid #ccc; text-align:center; font-size:0.9rem;}
th { background:#eee; }
.dark-mode th { background:#444; }
.chart-container { width:100%; height:300px; margin-top:1rem; }
.slider-container { display:flex; align-items:center; margin:0.5rem 0; gap:0.5rem;}
footer { text-align:center; padding:1rem; background:#eee; margin-top:2rem; font-size:0.9rem;}
</style>
</head>
<body class="light-mode">

<header>
  <div class="d-flex align-items-center">
    <img src="assets/logo.png" alt="logo" class="logo">
    <span style="margin-right:0.5rem;">Financial Analyzer</span>
  </div>
  <div>
    <select id="currencySelect">
      <option value="EGP">Ø¬Ù†ÙŠÙ‡</option>
      <option value="USD">USD</option>
      <option value="EUR">EUR</option>
    </select>
    <button id="toggleDarkMode">ÙˆØ¶Ø¹</button>
    <button id="toggleLanguage">EN / AR</button>
  </div>
</header>

<div class="watermark">
  <img src="assets/logo.png" alt="watermark" height="300">
</div>

<main>
  <h1 style="text-align:center;">ğŸ’ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯</h1>
  <p style="text-align:center;">ØªÙØ§Ø¹Ù„Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©ØŒ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø¶Ø§ÙØ©ØŒ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„ØªÙ†Ø¨Ø¤Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµÙØ­Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±.</p>

  <div class="slider-container">
    <label for="riskMultiplier">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø±:</label>
    <input type="range" id="riskMultiplier" min="0.8" max="1.5" step="0.05" value="1">
    <span id="riskValue">1.00</span>
  </div>

  <div id="ratiosContainer"></div>
  <div id="chartsContainer"></div>
</main>

<footer>
  &copy; 2025 Ø§Ù„Ù…Ø­Ù„Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ â€” Financial Analyzer
</footer>

<script>
let isDarkMode = false;
let currentLang = 'AR';
let currentCurrency = 'EGP';
let reportData = null;

async function fetchReportData() {
  try { const res = await fetch('report.json'); const data = await res.json(); return data; }
  catch(err){ console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±:', err); alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±!'); return null; }
}

function calculateRatios(data, riskMultiplier) {
  const predictiveMultiplier = { best:1.2*riskMultiplier, normal:1.1*riskMultiplier, conservative:1.05*riskMultiplier };
  return {
    Ø§Ù„Ø³ÙŠÙˆÙ„Ø©:[
      { name:'Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©', value:(data.assets/data.liabilities).toFixed(2), explanation:'Ù‚Ø¯Ø±Ø© Ø§Ù„Ø´Ø±ÙƒØ© Ø¹Ù„Ù‰ ØªØºØ·ÙŠØ© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø© Ø§Ù„Ø£Ø¬Ù„.'},
      { name:'Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©', value:((data.assets - data.inventory)/data.liabilities).toFixed(2), explanation:'Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø¨Ø¯ÙˆÙ† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†.'},
      { name:'Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©', value:(data.cash/data.liabilities).toFixed(2), explanation:'Ù‚Ø¯Ø±Ø© Ø§Ù„Ù†Ù‚Ø¯ Ø§Ù„ÙÙˆØ±ÙŠ Ø¹Ù„Ù‰ ØªØºØ·ÙŠØ© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª.'}
    ],
    Ø§Ù„Ø±Ø¨Ø­ÙŠØ©:[
      { name:'Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ', value:((data.netProfit/data.revenue*100).toFixed(2))+'%', explanation:'Ù†Ø³Ø¨Ø© ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ù…Ù† Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª.'},
      { name:'Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£ØµÙˆÙ„', value:((data.netProfit/data.assets*100).toFixed(2))+'%', explanation:'ÙƒÙØ§Ø¡Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£ØµÙˆÙ„ Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­.'},
      { name:'Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©', value:((data.netProfit/data.equity*100).toFixed(2))+'%', explanation:'Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±Ø©.'}
    ],
    Ø§Ù„Ù†Ø´Ø§Ø·:[
      { name:'Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', value:(data.cost/data.inventory).toFixed(2), explanation:'Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†.'},
      { name:'Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ø°Ù…Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', value:(data.revenue/data.accountsReceivable).toFixed(2), explanation:'Ø³Ø±Ø¹Ø© ØªØ­ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª.'},
      { name:'Ù…Ø¤Ø´Ø± Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø´Ø§Ù…Ù„', value:(data.revenue/data.assets).toFixed(2), explanation:'ÙƒÙØ§Ø¡Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£ØµÙˆÙ„ Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª.'}
    ],
    Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©:[
      { name:'Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©', value:((data.liabilities/data.assets*100).toFixed(2))+'%', explanation:'Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø¨Ø§Ù„Ø¯ÙŠÙ† Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ø£ØµÙˆÙ„.'},
      { name:'Ø§Ù„Ø¯ÙŠÙ† Ø¥Ù„Ù‰ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©', value:(data.liabilities/data.equity).toFixed(2), explanation:'Ù‡ÙŠÙƒÙ„ Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„.'},
      { name:'Ù…Ø¤Ø´Ø± Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø§Ù„ÙŠ', value:((data.liabilities/(data.assets+data.equity))*100).toFixed(2)+'%', explanation:'ØªÙ‚Ø¯ÙŠØ± Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ©.'}
    ],
    Ø§Ù„Ù‚ÙŠÙ…_Ø§Ù„Ù…Ø¶Ø§ÙØ©:[
      { name:'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ø§Ù„ØµØ§ÙÙŠØ©', value:(data.netProfit - data.interest).toFixed(2), explanation:'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯ Ø§Ù„ÙÙˆØ§Ø¦Ø¯.'},
      { name:'Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©', value:(((data.netProfit - data.interest)/data.assets*100).toFixed(2))+'%', explanation:'Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ù„Ù„Ø£ØµÙˆÙ„.'}
    ],
    Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª:[
      { name:'ØªÙˆÙ‚Ø¹ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ø£ÙØ¶Ù„ Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ)', value:(data.revenue*predictiveMultiplier.best).toFixed(2), explanation:'ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙÙŠ Ø£ÙØ¶Ù„ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª.'},
      { name:'ØªÙˆÙ‚Ø¹ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø¹Ø§Ø¯ÙŠ)', value:(data.revenue*predictiveMultiplier.normal).toFixed(2), explanation:'ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙÙŠ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ.'},
      { name:'ØªÙˆÙ‚Ø¹ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ù…Ø­Ø§ÙØ¸)', value:(data.revenue*predictiveMultiplier.conservative).toFixed(2), explanation:'ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙÙŠ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„Ù…Ø­Ø§ÙØ¸.'}
    ]
  };
}

function renderTables(ratios) {
  const container = document.getElementById('ratiosContainer'); container.innerHTML = '';
  for (let category in ratios){
    let card = document.createElement('div'); card.className='card';
    card.innerHTML=`<div class="card-header">${category}</div>
      <div class="card-body">
        <table>
          <thead><tr><th>Ø§Ù„Ù†Ø³Ø¨Ø©</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„ØªÙØ³ÙŠØ±</th></tr></thead>
          <tbody>${ratios[category].map(r=>`<tr><td>${r.name}</td><td>${r.value}</td><td>${r.explanation}</td></tr>`).join('')}</tbody>
        </table>
      </div>`;
    container.appendChild(card);
  }
}

let chartInstances = {};
function renderCharts(ratios){
  const chartsContainer=document.getElementById('chartsContainer'); chartsContainer.innerHTML='';
  for(let category in ratios){
    let card=document.createElement('div'); card.className='card'; card.style.marginTop='1rem';
    card.innerHTML=`<div class="card-header">Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯: ${category}</div>
      <div class="card-body"><canvas id="${category}Chart" height="250"></canvas></div>`;
    chartsContainer.appendChild(card);

    if(chartInstances[category]) chartInstances[category].destroy();
    chartInstances[category]=new Chart(document.getElementById(category+'Chart').getContext('2d'),{
      type:'bar',
      data:{ labels:ratios[category].map(r=>r.name), datasets:[{ label:'Ø§Ù„Ù‚ÙŠÙ…Ø©', data:ratios[category].map(r=>parseFloat(r.value)), backgroundColor:'rgba(0,123,255,0.6)', borderColor:'#0056b3', borderWidth:2, borderRadius:10, hoverBackgroundColor:'rgba(0,123,255,0.9)'}]},
      options:{
        responsive:true,
        plugins:{ legend:{ display:false } },
        scales:{ y:{ beginAtZero:true, grid:{ color:'rgba(0,0,0,0.1)' } }, x:{ grid:{ color:'rgba(0,0,0,0.1)' } } }
      }
    });
  }
}

document.getElementById('toggleDarkMode').onclick = ()=>{ isDarkMode=!isDarkMode; document.body.className=isDarkMode?'dark-mode':'light-mode'; };
document.getElementById('toggleLanguage').onclick = ()=>{ currentLang=currentLang==='AR'?'EN':'AR'; alert('ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© Ø¥Ù„Ù‰ '+currentLang); };
document.getElementById('currencySelect').onchange = (e)=>{ currentCurrency=e.target.value; alert('ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø© Ø¥Ù„Ù‰ '+currentCurrency); };
document.getElementById('riskMultiplier').oninput = (e)=>{
  let val=parseFloat(e.target.value).toFixed(2);
  document.getElementById('riskValue').innerText=val;
  if(reportData){ const ratios=calculateRatios(reportData,val); renderTables(ratios); renderCharts(ratios); }
};

async function init(){
  reportData = await fetchReportData();
  if(!reportData) return;
  const ratios = calculateRatios(reportData,1);
  renderTables(ratios); renderCharts(ratios);
}

init();
</script>
</body>
</html>
