<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© - Financial Analyzer</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: "Cairo", sans-serif;
      background: #f4f7fa;
      color: #333;
      transition: background 0.3s, color 0.3s;
    }
    body.dark { background: #121212; color: #eee; }

    header {
      padding: 15px 30px;
      display: flex; justify-content: space-between; align-items: center;
      background: #0077b6; color: #fff;
    }
    body.dark header { background: #1c1c1c; }

    .logo { display: flex; align-items: center; gap: 10px; font-weight: 700; }
    .logo img { height: 35px; }

    .controls { display: flex; gap: 10px; }
    button, select, input {
      padding: 6px 12px; border-radius: 6px; border: none; cursor: pointer;
    }
    .btn-dark { background: #333; color: #fff; }
    .btn-lang { background: #023e8a; color: #fff; }
    select, input { border: 1px solid #ccc; }
    body.dark select, body.dark input { background: #333; color: #fff; border: 1px solid #666; }

    main { padding: 20px; max-width: 1200px; margin: auto; }
    h1 { text-align: center; margin-bottom: 20px; }

    table {
      width: 100%; border-collapse: collapse; margin-bottom: 20px;
    }
    th, td {
      padding: 10px; border: 1px solid #ccc; text-align: center;
    }
    body.dark th, body.dark td { border-color: #444; }

    .actions { display: flex; gap: 10px; justify-content: center; margin-top: 15px; flex-wrap: wrap; }
    .actions button { background: #0077b6; color: #fff; font-weight: 600; }
    .actions button:hover { background: #023e8a; }

    .totals { text-align: center; margin: 20px 0; font-weight: bold; }

    footer {
      padding: 10px; text-align: center; font-size: 0.9rem;
      background: #f0f0f0; border-top: 1px solid #ddd;
    }
    body.dark footer { background: #1c1c1c; border-color: #333; color: #aaa; }

    canvas { max-width: 600px; margin: 20px auto; display: block; }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="logo">
      <img src="assets/logo.png" alt="Logo">
      <span id="title">Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
    </div>
    <div class="controls">
      <button class="btn-dark" id="darkToggle">ğŸŒ™</button>
      <button class="btn-lang" id="langToggle">EN</button>
      <select id="currencySelect">
        <option value="EGP">EGP</option>
        <option value="USD">USD</option>
        <option value="EUR">EUR</option>
      </select>
      <input type="number" id="exchangeRate" placeholder="Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù" step="0.01"/>
      <button onclick="window.location.href='index.html'">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>
  </header>

  <!-- Main -->
  <main>
    <h1 id="pageTitle">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h1>

    <table id="trialTable">
      <thead>
        <tr>
          <th>Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</th>
          <th>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</th>
          <th>Ù…Ø¯ÙŠÙ†</th>
          <th>Ø¯Ø§Ø¦Ù†</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody id="tbBody"></tbody>
    </table>

    <div class="actions">
      <button id="addRow">â• Ø¥Ø¶Ø§ÙØ© ØµÙ</button>
      <button id="exportExcel">ğŸ“Š ØªØµØ¯ÙŠØ± Excel</button>
      <button id="exportPDF">ğŸ“„ ØªØµØ¯ÙŠØ± PDF</button>
    </div>

    <div class="totals">
      <p id="totalsText">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø¯ÙŠÙ†: 0 | Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¯Ø§Ø¦Ù†: 0</p>
    </div>

    <canvas id="chart"></canvas>
  </main>

  <footer>
    <p>Â© 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - Financial Analyzer</p>
  </footer>

  <script>
    const tbBody = document.getElementById("tbBody");
    const totalsText = document.getElementById("totalsText");
    const currencySelect = document.getElementById("currencySelect");
    const exchangeRateInput = document.getElementById("exchangeRate");

    const accountTypes = [
      "Ø£ØµÙˆÙ„","Ø®ØµÙˆÙ…","Ø¥ÙŠØ±Ø§Ø¯Ø§Øª","Ù…ØµØ±ÙˆÙØ§Øª","Ø­Ù‚ÙˆÙ‚ Ù…Ù„ÙƒÙŠØ©","Ø£Ø±Ø¨Ø§Ø­ Ù…Ø­ØªØ¬Ø²Ø©","Ø£Ø®Ø±Ù‰"
    ];

    // Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
    function addRow(name="", type="", debit="", credit="") {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="text" value="${name}" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"></td>
        <td>
          <select onchange="checkCustomType(this)">
            ${accountTypes.map(t => `<option ${t===type?"selected":""}>${t}</option>`).join("")}
          </select>
        </td>
        <td><input type="number" value="${debit}" step="0.01" class="debit"></td>
        <td><input type="number" value="${credit}" step="0.01" class="credit"></td>
        <td><button onclick="this.closest('tr').remove(); updateTotals();">ğŸ—‘ï¸</button></td>
      `;
      tbBody.appendChild(row);
    }

    // ØµÙ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø£ÙˆÙ„
    addRow();

    // Ø²Ø± Ø¥Ø¶Ø§ÙØ©
    document.getElementById("addRow").addEventListener("click", () => addRow());

    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
    function updateTotals(){
      let totalDebit=0, totalCredit=0;
      tbBody.querySelectorAll("tr").forEach(r=>{
        const d = parseFloat(r.querySelector(".debit").value)||0;
        const c = parseFloat(r.querySelector(".credit").value)||0;
        totalDebit += d;
        totalCredit += c;
      });

      let currency = currencySelect.value;
      let rate = parseFloat(exchangeRateInput.value)||1;

      totalsText.textContent = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø¯ÙŠÙ†: ${(totalDebit*rate).toFixed(2)} ${currency} | Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¯Ø§Ø¦Ù†: ${(totalCredit*rate).toFixed(2)} ${currency}`;

      drawChart(totalDebit*rate, totalCredit*rate);
    }

    tbBody.addEventListener("input", updateTotals);
    currencySelect.addEventListener("change", updateTotals);
    exchangeRateInput.addEventListener("input", updateTotals);

    // Chart
    let chart;
    function drawChart(debit, credit){
      if(chart) chart.destroy();
      chart = new Chart(document.getElementById("chart"),{
        type:"doughnut",
        data:{
          labels:["Ù…Ø¯ÙŠÙ†","Ø¯Ø§Ø¦Ù†"],
          datasets:[{data:[debit,credit], backgroundColor:["#0077b6","#ef233c"]}]
        }
      });
    }

    // Excel
    document.getElementById("exportExcel").addEventListener("click", ()=>{
      const wb = XLSX.utils.book_new();
      const ws_data = [["Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨","Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨","Ù…Ø¯ÙŠÙ†","Ø¯Ø§Ø¦Ù†"]];
      tbBody.querySelectorAll("tr").forEach(r=>{
        const vals=[...r.querySelectorAll("input,select")].map(el=>el.value);
        ws_data.push(vals);
      });
      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      XLSX.utils.book_append_sheet(wb,ws,"Trial Balance");
      XLSX.writeFile(wb,"trial_balance.xlsx");
    });

    // PDF
    document.getElementById("exportPDF").addEventListener("click", ()=>{
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.addImage("assets/logo.png","PNG",10,10,20,20);
      doc.text("Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",105,20,null,null,"center");

      let y=40;
      doc.text("Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ | Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨ | Ù…Ø¯ÙŠÙ† | Ø¯Ø§Ø¦Ù†",10,y);
      y+=10;
      tbBody.querySelectorAll("tr").forEach(r=>{
        const vals=[...r.querySelectorAll("input,select")].map(el=>el.value);
        doc.text(vals.join(" | "),10,y);
        y+=10;
      });

      doc.setFontSize(40);
      doc.setTextColor(150,150,150);
      doc.text("Financial Analyzer",35,150,{angle:45,opacity:0.2});

      doc.save("trial_balance.pdf");
    });

    // Custom type
    function checkCustomType(sel){
      if(sel.value==="Ø£Ø®Ø±Ù‰"){
        const custom=prompt("Ø£Ø¯Ø®Ù„ Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨:");
        if(custom){ sel.innerHTML+=`<option selected>${custom}</option>`; }
      }
    }

    // Dark mode
    const savedTheme = localStorage.getItem("theme");
    if(savedTheme==="dark") document.body.classList.add("dark");
    document.getElementById("darkToggle").addEventListener("click",()=>{
      document.body.classList.toggle("dark");
      localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light");
    });

    // Language toggle
    document.getElementById("langToggle").addEventListener("click",()=>{
      const lang=document.documentElement.lang;
      if(lang==="ar"){ switchToEnglish(); localStorage.setItem("lang","en"); }
      else { switchToArabic(); localStorage.setItem("lang","ar"); }
    });

    function switchToEnglish(){
      document.documentElement.lang="en"; document.documentElement.dir="ltr";
      document.getElementById("title").textContent="Trial Balance Input";
      document.getElementById("pageTitle").textContent="Enter Trial Balance Data";
      document.getElementById("langToggle").textContent="AR";
      document.getElementById("exportExcel").textContent="ğŸ“Š Export Excel";
      document.getElementById("exportPDF").textContent="ğŸ“„ Export PDF";
      document.querySelector("footer p").textContent="Â© 2025 All rights reserved - Financial Analyzer";
    }
    function switchToArabic(){
      document.documentElement.lang="ar"; document.documentElement.dir="rtl";
      document.getElementById("title").textContent="Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©";
      document.getElementById("pageTitle").textContent="Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©";
      document.getElementById("langToggle").textContent="EN";
      document.getElementById("exportExcel").textContent="ğŸ“Š ØªØµØ¯ÙŠØ± Excel";
      document.getElementById("exportPDF").textContent="ğŸ“„ ØªØµØ¯ÙŠØ± PDF";
      document.querySelector("footer p").textContent="Â© 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - Financial Analyzer";
    }
  </script>
</body>
</html>
