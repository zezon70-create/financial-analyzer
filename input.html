<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title data-translate-key="pageTitle">المحلل المالي</title>
<script src="js/auth-guard.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
<link rel="stylesheet" href="css/style.css">
<link rel="manifest" href="manifest.json">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body data-theme="light"> 
    <div id="navbar-placeholder"></div>
    <main class="container-main py-4">
                <section class="page-header mb-4">
            <h1 data-translate-key="pageHeader"></h1>
            <p class="text-muted" data-translate-key="pageSubheader"></p>
        </section>
        <ul class="nav nav-pills nav-fill mb-4" id="entryTypeTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="manual-tab" data-bs-toggle="pill" data-bs-target="#manual-pane" type="button" role="tab" aria-controls="manual-pane" aria-selected="true">
                    <i class="bi bi-keyboard fs-5 me-2"></i> <span class="fw-bold" data-translate-key="manualEntryTab">إدخال يدوي</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="upload-tab" data-bs-toggle="pill" data-bs-target="#upload-pane" type="button" role="tab" aria-controls="upload-pane" aria-selected="false">
                    <i class="bi bi-file-earmark-arrow-up fs-5 me-2"></i> <span class="fw-bold" data-translate-key="uploadFileTab">رفع ملف</span>
                </button>
            </li>
        </ul>
        <div class="tab-content" id="entryTypeTabsContent">
<div class="tab-pane fade show active" id="manual-pane" role="tabpanel" aria-labelledby="manual-tab">
                <section class="card-surface">
                    <div class="row g-4">
                        <div class="col-lg-7">
                            <h5 data-translate-key="actionsTitle"></h5>
                            <div class="d-flex gap-2 flex-wrap mb-3">
                                <button id="addRowBtn" class="btn btn-primary"><i class="bi bi-plus-lg"></i> <span data-translate-key="add"></span></button>
                                <button id="saveBtn" class="btn btn-outline-secondary"><i class="bi bi-save"></i> <span data-translate-key="save"></span></button>
                                <button id="clearBtn" class="btn btn-outline-danger"><i class="bi bi-trash"></i> <span data-translate-key="clear"></span></button>
                                <button id="savePreviousBtn" class="btn btn-outline-info"><i class="bi bi-calendar-minus"></i> <span data-translate-key="savePrevious"></span></button>
                                </div>
                            <div class="p-3 rounded border" style="background-color: rgba(13, 110, 253, 0.03);">
                                <label for="saveAsName" class="form-label fw-bold small" data-translate-key="saveForComparison"></label>
                                <div class="input-group">
                                    <input type="text" id="saveAsName" class="form-control" data-translate-key="saveAsPlaceholder" placeholder="">
                                    <button id="saveAsBtn" class="btn btn-info text-white"><i class="bi bi-archive-fill"></i> <span data-translate-key="saveAs"></span></button>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-5">
                            <h5 data-translate-key="currencyTitle"></h5>
                            <div class="row g-2">
                                <div class="col-6">
                                    <label for="currencySelect" class="form-label small" data-translate-key="currencyLabel"></label>
                                    <select id="currencySelect" class="form-select"></select>
                                </div>
                                <div class="col-6">
                                    <label for="fxRateInput" class="form-label small" data-translate-key="fxRateLabel"></label>
                                    <input type="number" id="fxRateInput" class="form-control" step="any" disabled>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                        <section class="card-surface mt-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 data-translate-key="tableTitle"></h5>
                        <div id="validationResult" class="fw-bold"></div>
                    </div>
                    <div class="table-responsive">
                        <table id="trialTable" class="table align-middle">
                            <thead>
                                <tr>
                                    <th scope="col" data-translate-key="thAccount"></th>
                                    <th scope="col" data-translate-key="thMainType"></th>
                                    <th scope="col" data-translate-key="thSubType"></th>
                                    <th scope="col" class="text-end" data-translate-key="thDebit"></th>
                                    <th scope="col" class="text-end" data-translate-key="thCredit"></th>
                                    <th scope="col" data-translate-key="thAction"></th>
                                </tr>
                            </thead>
                            <tbody id="tbBody"></tbody>
                        </table>
                    </div>
                </section>
            </div> <div class="tab-pane fade" id="upload-pane" role="tabpanel" aria-labelledby="upload-tab">
<section class="card-surface">
                    <h5 data-translate-key="uploadFileTitle">رفع ملف ميزان المراجعة (Excel أو CSV)</h5>                  
                    <div id="fileDropArea" class="card p-5 text-center mt-3" style="border: 3px dashed var(--bs-primary-border-subtle); background-color: var(--bs-tertiary-bg); cursor: pointer;">
                        <i class="bi bi-cloud-arrow-up" style="font-size: 4rem; color: var(--bs-primary);"></i>
                        <p class="h5 mt-3 mb-2" data-translate-key="uploadDragDrop">اسحب وأفلت ملفك هنا، أو اضغط للاختيار</p>
                        <p class="text-muted small" data-translate-key="uploadSupportedFiles">الملفات المدعومة: .xlsx, .xls, .csv</p>
                        <input type="file" id="fileUploader" class="d-none" accept=".xlsx, .xls, .csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv">
                        <button type="button" class="btn btn-primary btn-lg mt-3 align-self-center" id="browseButton">
                            <span data-translate-key="uploadBrowseButton">تصفح الملفات</span>
                        </button>
                    </div>
    <div id="filePreviewArea" class="mt-4 d-none">
                        <h5><i class="bi bi-check-circle-fill text-success"></i> <span data-translate-key="uploadFileReady">الملف جاهز للمعالجة</span></h5>
                        <div id="fileNameDisplay" class="alert alert-success"></div>                       
                        <div id="previewSpinner" class="text-center my-3 d-none">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p data-translate-key="loadingPreview">جاري تحميل المعاينة...</p>
                        </div>
     <h6 data-translate-key="dataPreview">معاينة أول 5 صفوف:</h6>
                        <div id="filePreviewTable" class="table-responsive small border rounded p-2"></div>
                        <hr class="my-4">
                        <h5 data-translate-key="columnMappingTitle">مطابقة الأعمدة</h5>
                        <p class="text-muted" data-translate-key="columnMappingSubtitle">الرجاء مطابقة الأعمدة من ملفك مع الحقول المطلوبة في النظام.</p>
                                                <div id="columnMapper" class="row g-3 p-3 border rounded" style="background-color: var(--bs-tertiary-bg);"></div>
                        <button id="processFileBtn" class="btn btn-success btn-lg mt-4 w-100"><i class="bi bi-gear-fill me-2"></i> <span data-translate-key="processFileButton">معالجة الملف وملء الجدول</span></button>
                    </div>
</section>
</div> </div> 
</main>
<div id="footer-placeholder"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/main.js"></script>
<script src="js/input-app.js"></script>
<script>
if ('serviceWorker' in navigator) {
window.addEventListener('load', () => {
navigator.serviceWorker.register('service-worker.js')
.then((reg) => {
console.log('Service worker متسجل وتمام:', reg);
})
.catch((err) => {
console.log('فشل تسجيل Service worker:', err);
});
});
}
</script>
</body>
</html>

