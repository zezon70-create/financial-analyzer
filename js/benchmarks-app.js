const benchmarksTranslations={ar:{pageTitle:"المقارنات المعيارية — المحلل المالي",pageHeader:"المقارنات المعيارية",pageSubheader:"قارن نسبك المالية بمتوسطات الصناعة والفترة السابقة لفهم وضعك التنافسي.",navBenchmarks:"المقارنات المعيارية",exportPdf:"تصدير PDF",thRatio:"النسبة",thPreviousValue:"الفترة السابقة",thCurrentValue:"الفترة الحالية",thIndustryAvg:"متوسط الصناعة",thComment:"مقارنة (بالصناعة)",noDataForRatios:"لا توجد نسب محسوبة. يرجى تشغيل صفحة 'التحليلات المتقدمة' أولاً.",noDataForPreviousRatios:"لم يتم العثور على بيانات فترة سابقة.",liquidityRatios:"مؤشرات السيولة",profitabilityRatios:"مؤشرات الربحية",leverageRatios:"مؤشرات الروافع والمديونية",activityRatios:"مؤشرات النشاط",currentRatio:"نسبة التداول",quickRatio:"نسبة السيولة السريعة",netProfitMargin:"هامش صافي الربح",grossProfitMargin:"هامش الربح الإجمالي",roa:"العائد على الأصول (ROA)",roe:"العائد على حقوق الملكية (ROE)",debtToEquity:"نسبة الديون لحقوق الملكية",debtToAssets:"نسبة الديون للأصول",inventoryTurnover:"معدل دوران المخزون",assetTurnover:"معدل دوران الأصول",receivablesTurnover:"معدل دوران العملاء",avgCollectionPeriod:"متوسط فترة التحصيل",interestCoverageRatio:"عدد مرات تغطية الفوائد",financialLeverage:"الرافعة المالية",cashRatio:"نسبة النقد",netWorkingCapital:"صافي راس المال العامل",selectIndustryLabel:"اختر قطاع الصناعة للمقارنة",selectIndustryDesc:"اختيار قطاع سيضيف مقارنة مع متوسطات الصناعة إلى جداول النسب.",industry_general:"عام / غير محدد",industry_retail:"تجارة التجزئة",industry_manufacturing:"الصناعة التحويلية",industry_services:"الخدمات",industry_construction:"المقاولات",comparison_better:"أفضل",comparison_worse:"أسوأ",comparison_similar:"مماثل"},en:{pageTitle:"Industry Benchmarks — Financial Analyzer",pageHeader:"Industry Benchmarks",pageSubheader:"Compare your financial ratios against industry averages and your prior period.",navBenchmarks:"Benchmarks",exportPdf:"Export PDF",thRatio:"Ratio",thPreviousValue:"Previous Value",thCurrentValue:"Current Value",thIndustryAvg:"Industry Avg.",thComment:"Comparison (vs. Industry)",noDataForRatios:"No calculated ratios found. Please run the 'Advanced Analytics' page first.",noDataForPreviousRatios:"No prior period data found.",liquidityRatios:"Liquidity Ratios",profitabilityRatios:"Profitability Ratios",leverageRatios:"Leverage Ratios",activityRatios:"Activity Ratios",currentRatio:"Current Ratio",quickRatio:"Quick Ratio",netProfitMargin:"Net Profit Margin",grossProfitMargin:"Gross Profit Margin",roa:"Return on Assets (ROA)",roe:"Return on Equity (ROE)",debtToEquity:"Debt-to-Equity Ratio",debtToAssets:"Debt-to-Assets Ratio",inventoryTurnover:"Inventory Turnover",assetTurnover:"Asset Turnover",receivablesTurnover:"Receivables Turnover",avgCollectionPeriod:"Average Collection Period",interestCoverageRatio:"Interest Coverage Ratio",financialLeverage:"Financial Leverage",cashRatio:"Cash Ratio",netWorkingCapital:"Net Working Capital",selectIndustryLabel:"Select Industry for Benchmarking",selectIndustryDesc:"Choosing an industry will add benchmark averages to the ratio tables.",industry_general:"General / Unspecified",industry_retail:"Retail Trade",industry_manufacturing:"Manufacturing",industry_services:"Services",industry_construction:"Construction",comparison_better:"Better",comparison_worse:"Worse",comparison_similar:"Similar"}};window.pageTranslations=window.pageTranslations||{},window.pageTranslations.ar={...window.pageTranslations.ar||{},...benchmarksTranslations.ar||{}},window.pageTranslations.en={...window.pageTranslations.en||{},...benchmarksTranslations.en||{}},document.addEventListener("DOMContentLoaded",(()=>{console.log("[DEBUG] benchmarks-app.js script started execution.");const t={ratiosCurrent:{},ratiosPrevious:{},statementsPrevious:null,hasDataCurrent:!1,hasDataPrevious:!1,selectedIndustry:"general"},e=localStorage.getItem("lang")||"ar",r=t=>window.pageTranslations[e]?.[t]||`[${t}]`,i={industrySelect:document.getElementById("industrySelectBenchmark"),warningDiv:document.getElementById("ratiosDataWarningBenchmark")},a={general:{},retail:{currentRatio:1.5,quickRatio:.5,netProfitMargin:.03,roe:.15,debtToEquity:1.2,assetTurnover:2,grossProfitMargin:.3,avgCollectionPeriod:15,inventoryTurnover:8,interestCoverageRatio:4},manufacturing:{currentRatio:1.8,quickRatio:.9,netProfitMargin:.06,roe:.12,debtToEquity:.8,assetTurnover:1,grossProfitMargin:.35,avgCollectionPeriod:45,inventoryTurnover:6,interestCoverageRatio:5},services:{currentRatio:1.2,quickRatio:1,netProfitMargin:.08,roe:.18,debtToEquity:1,assetTurnover:1.2,grossProfitMargin:.5,avgCollectionPeriod:35,inventoryTurnover:20,interestCoverageRatio:6},construction:{currentRatio:1.3,quickRatio:.8,netProfitMargin:.04,roe:.14,debtToEquity:1.5,assetTurnover:1.5,grossProfitMargin:.2,avgCollectionPeriod:60,inventoryTurnover:10,interestCoverageRatio:3.5}},o=(t,e=1)=>isFinite(t)&&!isNaN(t)?`${(100*t).toFixed(e)}%`:"N/A",n=(t,e=2)=>isFinite(t)&&!isNaN(t)?t.toFixed(e):"N/A",s=t=>isFinite(t)&&!isNaN(t)?`${t.toFixed(0)} ${"ar"===e?"يوم":"Days"}`:"N/A",l=(t,e=0)=>isFinite(t)&&!isNaN(t)?t.toLocaleString(void 0,{minimumFractionDigits:e,maximumFractionDigits:e}):"N/A",c=()=>{t.hasDataCurrent=!1,t.hasDataPrevious=!1;try{const e=localStorage.getItem("calculatedRatios");if(!e)throw new Error("localStorage 'calculatedRatios' is missing. Run 'Advanced' page first.");const r=JSON.parse(e);if("object"!=typeof r||null===r)throw new Error("Parsed 'calculatedRatios' is not a valid object.");t.ratiosCurrent=r,t.hasDataCurrent=!0,console.log("[DEBUG] Successfully loaded calculatedRatios (Current):",t.ratiosCurrent)}catch(t){console.error("Benchmark Component Error (Current Ratios):",t)}try{const e=localStorage.getItem("financialDataPrevious");e?(t.statementsPrevious=JSON.parse(e),t.statementsPrevious&&t.statementsPrevious.totals&&(()=>{if(!t.statementsPrevious||!t.statementsPrevious.totals)return t.hasDataPrevious=!1,!1;const e=t.statementsPrevious.totals;try{const r=e.totalAssets||0,i=e.totalEquity||0,a=e.totalLiabilities||0,o=e.totalRevenue||0,n=e.netProfit||0,s=e.totalCogs||0,l=e.ebit||0,c=e.totalInterest||0,u=e.inventory||0,d=e.accountsReceivable||0,g=e.totalCurrentAssets||0,v=e.totalCurrentLiabilities||0,y=e.cashEquivalents||0,h=e.grossProfit||0;return t.ratiosPrevious={currentRatio:0!==v?g/v:1/0,quickRatio:0!==v?(g-u)/v:1/0,netWorkingCapital:e.workingCapital||0,cashRatio:0!==v?y/v:1/0,inventoryTurnover:s>0&&u>0?s/u:1/0,assetTurnover:r>0?o/r:0,receivablesTurnover:d>0?o/d:1/0,avgCollectionPeriod:d>0&&o>0?d/o*365:1/0,debtToAssets:r>0?a/r:1/0,debtToEquity:i>0?a/i:1/0,interestCoverageRatio:0!==c?l/c:1/0,financialLeverage:0!==i&&0!==r?r/i:1/0,grossProfitMargin:0!==o?h/o:0,netProfitMargin:0!==o?n/o:0,roa:r>0?n/r:0,roe:i>0?n/i:0},t.hasDataPrevious=!0,console.log("[DEBUG] Successfully calculated Previous Ratios:",t.ratiosPrevious),!0}catch(e){return console.error("Error calculating PREVIOUS ratios:",e),t.hasDataPrevious=!1,!1}})()):console.warn("[DEBUG] 'financialDataPrevious' not found. No previous ratios will be shown.")}catch(t){console.error("Error parsing 'financialDataPrevious':",t)}return t.hasDataCurrent},u=(i,c,u)=>{const d=document.getElementById(i);if(!d)return;if(!t.hasDataCurrent)return void(d.innerHTML=`<h5 class="mb-3">${r(c)}</h5> <p class="text-muted">${r("noDataForRatios")}</p>`);const g=a[t.selectedIndustry]||{},v="general"!==t.selectedIndustry,y=t.hasDataPrevious;let h=`<h5 class="mb-3">${r(c)}</h5> <div class="table-responsive"> <table class="table table-sm table-striped"> <thead><tr> \n            <th>${r("thRatio")}</th> \n            ${y?`<th class="text-end">${r("thPreviousValue")}</th>`:""}\n            <th class="text-end">${r("thCurrentValue")}</th> \n            ${v?`<th class="text-end">${r("thIndustryAvg")}</th>`:""} \n            <th>${r("thComment")}</th> \n            </tr></thead> <tbody>`;u.forEach((i=>{if(void 0===t.ratiosCurrent[i])return;const a=t.ratiosCurrent[i],c=t.ratiosPrevious[i],u=g[i],d=i.includes("Margin")||i.includes("roa")||i.includes("roe"),m=i.includes("avgCollectionPeriod"),R="netWorkingCapital"===i;let p;p=m?s(a):d?o(a):R?l(a,0):n(a);let b="-";y&&void 0!==c&&isFinite(c)&&(b=m?s(c):d?o(c):R?l(c,0):n(c));let P="-";v&&void 0!==u&&isFinite(u)&&(P=m?s(u):d?o(u):R?l(u,0):n(u));let f="";if(y&&isFinite(a)&&isFinite(c)&&0!==c){let t;t="debtToEquity"===i||"debtToAssets"===i||"avgCollectionPeriod"===i?a<c:a>c,a!==c&&(f=t?`<i class="bi bi-graph-up-arrow text-success ms-1" title="${"ar"===e?"تحسن عن الفترة السابقة":"Improved vs. Prior"}"></i>`:`<i class="bi bi-graph-down-arrow text-danger ms-1" title="${"ar"===e?"تراجع عن الفترة السابقة":"Declined vs. Prior"}"></i>`)}let C="",T="";if(v&&void 0!==u&&isFinite(a)&&isFinite(u)){const t=.1*Math.abs(u);let e,o;"debtToEquity"===i||"debtToAssets"===i||"avgCollectionPeriod"===i?(e=a<u-t,o=a>u+t):(e=a>u+t,o=a<u+t),e?(C='<i class="bi bi-arrow-up-circle-fill text-success ms-1"></i>',T=`(${r("comparison_better")})`):o?(C='<i class="bi bi-arrow-down-circle-fill text-danger ms-1"></i>',T=`(${r("comparison_worse")})`):(C='<i class="bi bi-arrow-left-right text-warning ms-1"></i>',T=`(${r("comparison_similar")})`)}h+=`<tr> \n                <td>${r(i)}</td> \n                ${y?`<td class="text-end">${b}</td>`:""}\n                <td class="text-end"><strong>${p}</strong> ${f} ${C}</td> \n                ${v?`<td class="text-end">${P}</td>`:""} \n                <td class="text-muted small">${T}</td> \n                </tr>`})),d.innerHTML=h+"</tbody></table></div>"},d=()=>{u("liquidityRatiosBenchmark","liquidityRatios",["currentRatio","quickRatio","cashRatio","netWorkingCapital"]),u("profitabilityRatiosBenchmark","profitabilityRatios",["grossProfitMargin","netProfitMargin","roa","roe"]),u("leverageRatiosBenchmark","leverageRatios",["debtToAssets","debtToEquity","interestCoverageRatio","financialLeverage"]),u("activityRatiosBenchmark","activityRatios",["assetTurnover","inventoryTurnover","receivablesTurnover","avgCollectionPeriod"])};(()=>{if(console.log("[DEBUG] Initializing benchmarks page..."),!i.industrySelect||!i.warningDiv)return void console.error("Benchmark component critical elements not found.");"function"==typeof window.applyTranslations?(console.log("[DEBUG] Calling global applyTranslations..."),window.applyTranslations()):console.warn("[DEBUG] global applyTranslations not found.");i.industrySelect.innerHTML=["general","retail","manufacturing","services","construction"].map((t=>`<option value="${t}">${r(`industry_${t}`)}</option>G`)),t.selectedIndustry=localStorage.getItem("selectedIndustry")||"general",i.industrySelect.value=t.selectedIndustry,i.industrySelect.addEventListener("change",(e=>{t.selectedIndustry=e.target.value,localStorage.setItem("selectedIndustry",t.selectedIndustry),d()})),c()?(i.warningDiv.style.display="none",d(),t.hasDataPrevious||console.warn(r("noDataForPreviousRatios"))):(i.warningDiv.textContent=r("noDataForRatios"),i.warningDiv.style.display="block"),console.log("[DEBUG] Benchmarks page initialization finished.")})()}));
