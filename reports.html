<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Financial Analyzer - Tabs Navigation</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
body {font-family: Arial, sans-serif; transition: background 0.3s,color 0.3s;}
.dark-mode {background:#121212;color:#f5f5f5;}
.dark-mode .card {background:#1e1e1e;color:#f5f5f5;}
header {background:#0d6efd;color:#fff;padding:10px 20px;display:flex;align-items:center;justify-content:space-between;}
header img.logo {height:40px;margin-left:10px;}
.control-btn, .control-select {margin-left:5px;}
.watermark {position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);opacity:0.05;z-index:-1;}
</style>
</head>
<body>

<header>
  <div class="d-flex align-items-center">
    <img src="assets/logo.png" class="logo" alt="logo">
    <strong id="siteTitle">Financial Analyzer</strong>
  </div>
  <div class="d-flex align-items-center">
    <select id="currencySelect" class="form-select form-select-sm">
      <option value="EGP">Ø¬Ù†ÙŠÙ‡</option>
      <option value="USD">USD</option>
      <option value="EUR">EUR</option>
    </select>
    <button id="toggleDarkMode" class="control-btn btn btn-outline-light btn-sm">Dark/Light</button>
    <button id="toggleLanguage" class="control-btn btn btn-outline-light btn-sm">EN/AR</button>
  </div>
</header>

<div class="watermark"><img src="assets/logo.png" alt="watermark" height="300"></div>

<main class="container py-4">
  <!-- Tabs -->
  <ul class="nav nav-tabs" id="mainTabs">
    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#dashboardTab">Dashboard</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#reportTab">Reports</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#advancedTab">Advanced</a></li>
  </ul>

  <div class="tab-content mt-3">
    <!-- Dashboard -->
    <div id="dashboardTab" class="tab-pane fade show active">
      <div class="card p-3"><h4>Dashboard</h4><p>ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©.</p></div>
    </div>

    <!-- Reports -->
    <div id="reportTab" class="tab-pane fade">
      <div class="row g-3">
        <div class="col-lg-6"><div class="card shadow-sm p-3"><h5>ğŸ“Š Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h5><div id="trialBalanceReport"></div></div></div>
        <div class="col-lg-6"><div class="card shadow-sm p-3"><h5>ğŸ“‘ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„</h5><div id="incomeStatementReport"></div></div></div>
        <div class="col-lg-6"><div class="card shadow-sm p-3"><h5>ğŸ’° Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ù…ÙˆÙ…ÙŠØ©</h5><div id="balanceSheetReport"></div></div></div>
        <div class="col-lg-6"><div class="card shadow-sm p-3"><h5>ğŸ’µ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</h5><div id="cashFlowReport"></div></div></div>
      </div>
      <div class="mt-3 text-center">
        <button id="exportAll" class="btn btn-warning">ğŸ“¤ ØªØµØ¯ÙŠØ± Excel</button>
        <button id="printReport" class="btn btn-secondary">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© PDF</button>
      </div>
    </div>

    <!-- Advanced -->
    <div id="advancedTab" class="tab-pane fade">
      <div class="row g-3">
        <div class="col-lg-6"><div class="card shadow-sm p-3"><h5>ğŸ“ˆ Ø§Ù„Ù†Ø³Ø¨ ÙˆØ§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</h5><table><thead><tr><th>Ø§Ù„Ù†Ø³Ø¨Ø© / Ø§Ù„Ù…Ø¤Ø´Ø±</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„ØªÙØ³ÙŠØ±</th></tr></thead><tbody id="ratiosTable"></tbody></table></div></div>
        <div class="col-lg-6"><div class="card shadow-sm p-3"><h5>ğŸ”® Ø§Ù„ØªÙ†Ø¨Ø¤ ÙˆØ§Ù„Ø¹Ø§Ø¦Ø¯ ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±</h5><table><thead><tr><th>Ø§Ù„ØªØ­Ù„ÙŠÙ„</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„ØªÙØ³ÙŠØ±</th></tr></thead><tbody id="forecastTable"></tbody></table></div></div>
        <div class="col-lg-6"><div class="card shadow-sm p-3"><h6>ØªÙˆÙ‚Ø¹ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©</h6><canvas id="cashFlowForecastChart" height="200"></canvas></div></div>
        <div class="col-lg-6"><div class="card shadow-sm p-3"><h6>Ø§Ù„Ø¹Ø§Ø¦Ø¯ ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±</h6><canvas id="roiRiskChart" height="200"></canvas></div></div>
      </div>
    </div>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
function loadReportsData(){
  return window.parent?.reportData || {
    trialBalance:[{account:"Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©", debit:5000, credit:0},{account:"Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª", debit:0, credit:2000}],
    incomeStatement:[{item:"Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª", value:2000},{item:"Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª", value:1200}],
    balanceSheet:[{item:"Ø§Ù„Ø£ØµÙˆÙ„", value:5000},{item:"Ø§Ù„Ø®ØµÙˆÙ…", value:3000}],
    cashFlow:[{item:"Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„Ø©", value:4000},{item:"Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬Ø©", value:2000}]
  };
}

function renderTable(id,data,columns){
  const tbody=document.getElementById(id);tbody.innerHTML='';
  data.forEach(row=>{const tr=document.createElement('tr');columns.forEach(col=>{const td=document.createElement('td');td.textContent=row[col]||'';tr.appendChild(td);});tbody.appendChild(tr);});
}

function calculateRatios(data){
  const assets=data.balanceSheet.find(x=>x.item==="Ø§Ù„Ø£ØµÙˆÙ„")?.value||0;
  const liabilities=data.balanceSheet.find(x=>x.item==="Ø§Ù„Ø®ØµÙˆÙ…")?.value||0;
  const equity=assets-liabilities;
  const revenue=data.incomeStatement.find(x=>x.item==="Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª")?.value||0;
  const expense=data.incomeStatement.find(x=>x.item==="Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª")?.value||0;
  return [
    {ratio:"Ù†Ø³Ø¨Ø© Ø§Ù„Ø³ÙŠÙˆÙ„Ø©", value:(assets/liabilities).toFixed(2), explanation:"Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ù…Ø­Ø³ÙˆØ¨Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹"},
    {ratio:"Ù†Ø³Ø¨Ø© Ø§Ù„Ø¯ÙŠÙ†", value:(liabilities/assets).toFixed(2), explanation:"Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ Ù„Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©"},
    {ratio:"ROE", value:((revenue-expense)/equity*100).toFixed(2)+"%", explanation:"Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„"},
    {ratio:"Ù…Ø¹Ø¯Ù„ Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†", value:"5 Ù…Ø±Ø§Øª", explanation:"Ù…Ø¤Ø´Ø± ØªÙˆØ¶ÙŠØ­ÙŠ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ"},
    {ratio:"Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ØµÙŠÙ„", value:"30 ÙŠÙˆÙ…", explanation:"Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© ØªØ­ØµÙŠÙ„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª"}
  ];
}

function calculateForecasts(data){
  const revenue=data.incomeStatement.find(x=>x.item==="Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª")?.value||0;
  const expense=data.incomeStatement.find(x=>x.item==="Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª")?.value||0;
  const netIncome=revenue-expense;
  return [
    {analysis:"Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹", value:netIncome, explanation:"ØµØ§ÙÙŠ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ"},
    {analysis:"Ø§Ù„Ù†Ù…Ùˆ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹", value:(netIncome/revenue*100).toFixed(2)+"%", explanation:"Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ù…Ùˆ"},
    {analysis:"Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©", value:"Ù…ØªÙˆØ³Ø·Ø©", explanation:"ØªØ­Ù„ÙŠÙ„ ØªÙ‚Ø±ÙŠØ¨ÙŠ"}
  ];
}

function renderCharts(data){
  const netCashFlow=data.cashFlow.find(x=>x.item==="Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„Ø©")?.value - data.cashFlow.find(x=>x.item==="Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬Ø©")?.value;
  new Chart(document.getElementById('cashFlowForecastChart'),{
    type:'line', data:{labels:['Ø§Ù„Ø´Ù‡Ø± 1','Ø§Ù„Ø´Ù‡Ø± 2','Ø§Ù„Ø´Ù‡Ø± 3'], datasets:[{label:'ØªÙˆÙ‚Ø¹ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª',data:[netCashFlow,netCashFlow*1.2,netCashFlow*1.5],borderColor:'blue',fill:false}]}
  });
  const roi=(data.incomeStatement[0].value-data.incomeStatement[1].value)/data.balanceSheet.find(x=>x.item==="Ø§Ù„Ø£ØµÙˆÙ„").value*100;
  new Chart(document.getElementById('roiRiskChart'),{
    type:'bar', data:{labels:['ROE','Ù…Ø®Ø§Ø·Ø±'], datasets:[{label:'Ø§Ù„Ù‚ÙŠÙ…',data:[roi,50],backgroundColor:['green','red']}]}
  });
}

// Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©
document.getElementById('exportAll').addEventListener('click', ()=>{
  const data=loadReportsData(); const wb=XLSX.utils.book_new();
  wb.SheetNames.push("Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"); wb.Sheets["Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"]=XLSX.utils.json_to_sheet(data.trialBalance);
  wb.SheetNames.push("Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„"); wb.Sheets["Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„"]=XLSX.utils.json_to_sheet(data.incomeStatement);
  wb.SheetNames.push("Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ù…ÙˆÙ…ÙŠØ©"); wb.Sheets["Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ù…ÙˆÙ…ÙŠØ©"]=XLSX.utils.json_to_sheet(data.balanceSheet);
  wb.SheetNames.push("Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©"); wb.Sheets["Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©"]=XLSX.utils.json_to_sheet(data.cashFlow);
  XLSX.writeFile(wb,'financial-report.xlsx');
});
document.getElementById('printReport').addEventListener('click', ()=>window.print());

// Dark Mode & Ø§Ù„Ù„ØºØ©
document.getElementById('toggleDarkMode').addEventListener('click', ()=>{document.body.classList.toggle('dark-mode');});
let isArabic=true;
document.getElementById('toggleLanguage').addEventListener('click', ()=>{
  isArabic=!isArabic;
  document.getElementById('siteTitle').textContent=isArabic?"Financial Analyzer":"Financial Analyzer (EN)";
});

// Render Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
const data=loadReportsData();
renderTable('trialBalanceReport',data.trialBalance,['account','debit','credit']);
renderTable('incomeStatementReport',data.incomeStatement,['item','value']);
renderTable('balanceSheetReport',data.balanceSheet,['item','value']);
renderTable('cashFlowReport',data.cashFlow,['item','value']);
renderTable('ratiosTable',calculateRatios(data),['ratio','value','explanation']);
renderTable('forecastTable',calculateForecasts(data),['analysis','value','explanation']);
renderCharts(data);
</script>
</body>
</html>
