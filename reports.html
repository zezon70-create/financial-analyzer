<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ© â€” Financial Analyzer</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; transition: background 0.3s, color 0.3s;}
.light-mode { background:#f4f4f4; color:#333;}
.dark-mode { background:#1e1e1e; color:#f4f4f4;}
header { background:#007bff; color:white; display:flex; align-items:center; justify-content:space-between; padding:0.5rem 1rem; }
header .logo { height:40px; }
header select, header button { margin-left:0.5rem; cursor:pointer;}
nav.navbar { margin-bottom:1rem; }
.watermark { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); opacity:0.05; z-index:-1;}
.card { border-radius:0.5rem; box-shadow:0 2px 12px rgba(0,0,0,0.15); margin-bottom:1rem; transition: transform 0.2s;}
.card:hover { transform: translateY(-3px);}
.dark-mode .card { background:#2b2b2b; color:#f4f4f4;}
.card-header { font-weight:bold; font-size:1rem; margin-bottom:0.5rem; background:#007bff; color:white; padding:0.5rem;}
table { width:100%; border-collapse:collapse; margin-top:0.5rem;}
th, td { padding:0.5rem; border:1px solid #ccc; text-align:center; font-size:0.9rem;}
th { background:#eee; }
.dark-mode th { background:#444; }
footer { text-align:center; padding:1rem; background:#eee; margin-top:2rem; font-size:0.9rem;}
</style>
</head>
<body class="light-mode">

<header>
  <div class="d-flex align-items-center">
    <img src="assets/logo.png" alt="logo" class="logo">
    <strong style="margin-right:0.5rem;">Financial Analyzer</strong>
  </div>
  <div>
    <select id="currencySelect">
      <option value="EGP">Ø¬Ù†ÙŠÙ‡</option>
      <option value="USD">USD</option>
      <option value="EUR">EUR</option>
    </select>
    <button id="toggleDarkMode">ÙˆØ¶Ø¹</button>
    <button id="toggleLanguage">EN / AR</button>
  </div>
</header>

<div class="watermark">
  <img src="assets/logo.png" alt="watermark" height="300">
</div>

<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container-fluid">
    <a class="navbar-brand" href="index.html">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a class="navbar-brand" href="input.html">Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a>
    <a class="navbar-brand" href="advanced.html">Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</a>
  </div>
</nav>

<main class="container py-4" id="report-area">
  <h2>ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ÙØµÙ„Ø©</h2>
  <p>Ø§Ø³ØªØ¹Ø±Ø¶ ÙˆØªØµØ¯ÙŠØ± Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ©: Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©ØŒ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„ØŒ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ù…ÙˆÙ…ÙŠØ©ØŒ ÙˆÙ‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©.</p>

  <div class="row g-3">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header">ğŸ“Š Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
        <div id="trialBalanceReport" class="card-body"></div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header">ğŸ“‘ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„</div>
        <div id="incomeStatementReport" class="card-body"></div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header">ğŸ’° Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ù…ÙˆÙ…ÙŠØ©</div>
        <div id="balanceSheetReport" class="card-body"></div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header">ğŸ’µ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</div>
        <div id="cashFlowReport" class="card-body"></div>
      </div>
    </div>
  </div>

  <div class="mt-4 text-center">
    <button id="exportAll" class="btn btn-warning">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Excel</button>
    <button id="printReport" class="btn btn-secondary">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± PDF</button>
  </div>
</main>

<footer>
  &copy; 2025 Ø§Ù„Ù…Ø­Ù„Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ â€” Financial Analyzer
</footer>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<script>
let isDarkMode=false;
let currentLang='AR';
let currentCurrency='EGP';

// Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ØµÙØ­Ø© Input
function loadReportData() {
  const session = JSON.parse(sessionStorage.getItem('financialData'));
  if(!session) { alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª'); return null; }
  return session;
}

// Ø¯ÙˆØ§Ù„ Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
function renderTrialBalance(data){
  if(!data.trialBalance) return 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª';
  let html='<table><thead><tr><th>Ø§Ù„Ø­Ø³Ø§Ø¨</th><th>Ù…Ø¯ÙŠÙ†</th><th>Ø¯Ø§Ø¦Ù†</th></tr></thead><tbody>';
  data.trialBalance.forEach(r=>{ html+=`<tr><td>${r.account}</td><td>${r.debit}</td><td>${r.credit}</td></tr>`; });
  html+='</tbody></table>'; return html;
}
function renderIncomeStatement(data){
  if(!data.incomeStatement) return 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª';
  let html='<table><thead><tr><th>Ø§Ù„Ø¨Ù†Ø¯</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr></thead><tbody>';
  data.incomeStatement.forEach(r=>{ html+=`<tr><td>${r.item}</td><td>${r.value}</td></tr>`; });
  html+='</tbody></table>'; return html;
}
function renderBalanceSheet(data){
  if(!data.balanceSheet) return 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª';
  let html='<table><thead><tr><th>Ø§Ù„Ø¨Ù†Ø¯</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr></thead><tbody>';
  data.balanceSheet.forEach(r=>{ html+=`<tr><td>${r.item}</td><td>${r.value}</td></tr>`; });
  html+='</tbody></table>'; return html;
}
function renderCashFlow(data){
  if(!data.cashFlow) return 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª';
  let html='<table><thead><tr><th>Ø§Ù„Ø¨Ù†Ø¯</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr></thead><tbody>';
  data.cashFlow.forEach(r=>{ html+=`<tr><td>${r.item}</td><td>${r.value}</td></tr>`; });
  html+='</tbody></table>'; return html;
}

// ØªØµØ¯ÙŠØ± Excel
document.getElementById('exportAll').addEventListener('click', ()=>{
  const data = loadReportData(); if(!data) return;
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(data.trialBalance),'Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©');
  XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(data.incomeStatement),'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„');
  XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(data.balanceSheet),'Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ù…ÙˆÙ…ÙŠØ©');
  XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(data.cashFlow),'Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©');
  XLSX.writeFile(wb,'financial-report.xlsx');
});

// Ø·Ø¨Ø§Ø¹Ø© PDF
document.getElementById('printReport').addEventListener('click', ()=>{
  const element = document.getElementById('report-area');
  html2pdf().from(element).save('financial-report.pdf');
});

// ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¯Ø§ÙƒÙ† Ùˆ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© Ùˆ Ø§Ù„Ø¹Ù…Ù„Ø©
document.getElementById('toggleDarkMode').onclick=()=>{ isDarkMode=!isDarkMode; document.body.className=isDarkMode?'dark-mode':'light-mode'; };
document.getElementById('toggleLanguage').onclick=()=>{ currentLang=currentLang==='AR'?'EN':'AR'; alert('ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© Ø¥Ù„Ù‰ '+currentLang); };
document.getElementById('currencySelect').onchange=(e)=>{ currentCurrency=e.target.value; alert('ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø© Ø¥Ù„Ù‰ '+currentCurrency); };

// ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function renderReports(){
  const data=loadReportData(); if(!data) return;
  document.getElementById('trialBalanceReport').innerHTML=renderTrialBalance(data);
  document.getElementById('incomeStatementReport').innerHTML=renderIncomeStatement(data);
  document.getElementById('balanceSheetReport').innerHTML=renderBalanceSheet(data);
  document.getElementById('cashFlowReport').innerHTML=renderCashFlow(data);
}

renderReports();
</script>

</body>
</html>
